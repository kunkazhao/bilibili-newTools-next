# 前端问题复盘与规则

本文总结近期前端出现的问题与原因，并给出可执行的规范，避免复发。

## 1. 已出现的问题与原因

### 1.1 商品图标题文字被“剃头/压住”
**表现**
- 标题或价格文字上下被裁切（Clipping）。
- 在浏览器预览正常，但生成图片时明显被切。

**原因**
- 标题使用 `line-clamp + overflow: hidden`，叠加小行高/负位移导致文字超出“行盒”被切。
- Headless 渲染（Puppeteer/Canvas）对中文字体基线计算与浏览器存在差异。
- 容器高度由内容撑起时，`flex` 居中 + `transform` 组合会放大偏移问题。

### 1.2 生成图片文件名错误（变成 商品_1/商品_2）
**表现**
- 批量生成图片时，文件名没有真实标题。

**原因**
- 使用了方案内的 `items`（可能只有 `id/source_id`），未合并选品库标题。
- 命名兜底逻辑仅使用 `title`，缺少 `uid/id` 兜底。

### 1.3 导出 JSON 字段格式不统一
**表现**
- `remark` 字段名称不符合需求。
- `价格`没有“元”单位。
- 京东链接为空或不正确。

**原因**
- 导出逻辑未做格式统一处理。
- 京东链接直接取 `source_link` 或 `link`，未校验域名。

## 2. 规则（必须遵守）

### 2.1 商品图片模板（Headless 渲染稳定性）
- **禁止**在标题上使用 `overflow: hidden` + 小行高 + 负位移的组合。
- 标题 **优先用 padding 撑开“保护区”**，避免基线差异导致裁切。
- 中文标题建议：`line-height >= 1.2`，并保证上下 `padding >= 6px`。
- 标题/价格所在容器建议设置 `min-height`，避免内容压缩。
- 若必须截断，优先用 `max-height` 控制，不使用 `line-clamp` + `overflow: hidden`。

### 2.2 图片命名规则
- 批量/单张生成时必须使用 **mergedItems**（含选品库标题）。
- 命名兜底顺序：`title` → `uid` → `id` → `商品_序号`。

### 2.3 导出 JSON 规则
- 字段命名统一为：`商品名称`、`价格`、`评价总结`、`所有参数`、`重点标记`、`京东链接`。
- `价格`必须带“元”，例如 `80元`。
- `京东链接`必须校验域名（`jd.com / 3.cn / jd.hk`），不符合则为空。

## 3. 执行检查清单
- [ ] 模板标题是否有足够 padding、无裁切风险？
- [ ] 批量图片命名是否走 mergedItems？
- [ ] 导出 JSON 是否符合字段命名与格式规则？
- [ ] 京东链接是否通过域名校验？
