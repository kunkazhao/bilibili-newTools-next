# 淘宝链接解析与佣金获取方案设计

日期：2026-02-03

## 背景
项目当前已支持京东推广链接解析与商品信息填充。现需要新增淘宝/天猫/淘宝联盟链接解析能力，并确保“纯佣金比例”可获取且稳定。

## 目标
- 支持淘宝/天猫/淘宝联盟链接解析。
- 仅使用两条 API：
  - taobao.tbk.item.click.extract（解析链接拿商品 ID）
  - taobao.tbk.item.details.upgrade.get（商品详情与纯佣金）
- 统一前端使用同一返回结构，避免页面各自解析。

## 非目标
- 不引入 itemid.coupon.get 或 dg.material.optional。
- 不做推广链接生成（仅解析与详情）。

## 影响范围（页面/功能）
- 选品库商品弹窗：新增淘宝链接解析与回填。
- 获取佣金页面：淘宝链接解析与入库。
- 蓝链映射页：如存在“解析填充”流程，新增淘宝分支。
- 方案详情页：若存在“解析/自动填充”，新增淘宝分支。
- 通用链接识别：保持对 taobao/tmall/union 链接识别。

## 方案总览
流程：
1) 解析链接 -> 获取 item_id/open_iid
2) 使用 item_id 查询详情 -> 获取标题/主图/价格/纯佣金
3) 前端按统一结构展示与保存

## API 调用流程
### 1. 解析链接
- 入参：原始淘宝/天猫/联盟链接
- 调用：taobao.tbk.item.click.extract
- 输出：item_id/open_iid、来源链接

### 2. 商品详情
- 入参：item_id（或 open_iid，按官方文档参数要求）
- 调用：taobao.tbk.item.details.upgrade.get
- 输出：
  - 标题/主图/价格
  - 纯佣金比例：publish_info.income_info.commission_rate

## 字段映射（建议）
- title -> 商品标题
- cover -> 主图（优先取首图）
- price -> 价格（按接口返回字段）
- commissionRate -> commission_rate 转换为百分比字符串（例如 1234 -> 12.34%）
- taobaoLink -> 标准商品链接（如可由详情返回或由原链接归一化）

## 前端接入
- 选品库商品弹窗：
  - 判断是否淘宝链接 -> 走解析与详情
  - 若已存在标题/封面内容，则不覆盖（保持现有逻辑）
- 获取佣金页面：
  - 支持淘宝链接输入与解析
  - 统计淘宝链接数量与结果
- 其他页面：若已有“解析回填”逻辑，按同一返回结构接入。

## 统一返回结构（示例）
{
  "platform": "taobao",
  "itemId": "xxxx",
  "title": "...",
  "cover": "...",
  "price": "...",
  "commissionRate": "12.34%",
  "shopName": "...",
  "sourceLink": "...",
  "materialUrl": "https://item.taobao.com/..."
}

## 异常处理
- 解析失败：提示“链接无法解析，请检查是否为淘宝/天猫/联盟链接”。
- 详情失败：提示“商品详情获取失败，请稍后再试”。
- 佣金为空：显示 0 或 “—”。（不再走其他接口补偿）

## 配置与权限
- 需要淘宝联盟开放平台配置（app_key、app_secret、session/adzone_id 等）
- 需确保账号有权限调用上述两条 API

## 测试点
- 淘宝/天猫/联盟链接解析成功/失败
- 佣金比例正确显示（纯佣金）
- 标题/主图/价格回填正确
- “已有内容不覆盖”逻辑有效
- 前端各入口一致性（选品库/获取佣金/蓝链映射/方案详情）

## 交付物
- 后端新增淘宝解析与详情接口
- 前端接入改造
- 文档与测试更新
